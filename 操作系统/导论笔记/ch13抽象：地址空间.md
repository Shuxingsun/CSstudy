# 抽象：地址空间

## 早期操作系统

- 早期操作系统模式

  <img src="https://picture-house.oss-cn-beijing.aliyuncs.com/notes/6.png" style="zoom:75%;" />

## 多道程序和时分共享

- 多道程序系统，为了更有效地共享机器
- 分时系统诞生，目的是为了交互性
  - **方法：**让一个进程单独占用全部内存运行一小段时间，然后停止它，并将它所有的状态信息保存在磁盘上（包含所有的物理内存），加载其他进程的状态信息，再运行一段时间，这就实现了某种比较粗糙的机器共享[M+63]。
  - **缺点：**太慢了。

## 地址空间

### 地址空间：运行的程序看到的系统中的内存

**进程地址空间包含运行程序的所有内存状态：**

- 代码

- 堆：函数调用信息，分配空间给局部变量，传递参数和函数返回值

- 栈：管理动态分配，用户管理的内存

  ![](https://picture-house.oss-cn-beijing.aliyuncs.com/notes/7.png)

### 关键问题：如何虚拟化内存

**操作系统如何在单一的物理内存上为多个运行的进程（所有进程共享内存）构建一个私有的、可能很大的地址空间的抽象**

### 提示：隔离原则

隔离是建立可靠系统的关键原则。如果两个实体相互隔离，这意味着一个实体的失败不会影响另一
 个实体。操作系统力求让进程彼此隔离，从而防止相互造成伤害

## 目标

### **虚拟内存系统目标：**

- 透明
  - 操作系统实现虚拟内存的方式，应该让运行的程序看不见。因此，程序不应该感知到内存被虚拟化的事实，相反，程序的行为就好像它拥有自己的私有物理内存。
- 效率：时间、空间
- 保护
  - 不会受其他进程影响，操作系统本身也不会受进程影响

### 所以永远不要忘记

如果你在**一个程序中打印出一个地址，那就是一个虚拟的地址**。虚拟地址只是提供地址如何在内存中分布的假象，只有操作系统（和硬件）才知道物理地址



